{{ extend './home/home.html' }}

{{ block 'title' }}
个人中心
{{ /block }}


{{ block 'style' }}

{{ block 'pri-style' }}

{{ /block }}

<style>
    body{
        background: #fff;
    }
    .personal-box{
        width: 1350px;
        background: #fff;
        display: inline-block;
        position: relative;
        left: 50%;
        transform: translate(-50%, 20px);
        min-height: 800px;


    }
    .box-l{
        display: inline-block;
        height: 100%;
        width: 270px;
        float: left;
    }
    .box-r{
        display: inline-block;
        width: 1030px;
        float: right;
    }
    .box-l .head{
        width: 100%;
    }
    .box-l .user-name{
        width: 100%;
        height: 85px;
        font-size: 25px;
        font-weight: 500;
        display: flex;
        align-items: center;
    }
    .box-l .user-email{
        width: 100%;
        height: 30px;
        display: flex;
        align-items: center;
        color: #666;
        margin-bottom: 20px;
    }
    .box-l .user-email img{
        height: 17px;
        width: 17px;
        margin-right: 5px;
    }
    .box-l .btn{
        width: 100%;
    }
    .top-bar{
        width: 100%;
        height: 54px;
        border-bottom: 1px solid #e1e1e1;
    }
    .top-bar span{
        float: left;
        display: inline-block;
        height: 100%;
        line-height: 54px;
        color: #586069;
        padding: 0 10px;
        cursor: pointer;
        margin-right: 40px;
    }
    .top-bar span:hover{
        border-bottom: 2px solid orangered;
    }
    .top-bar .active{
        border-bottom: 2px solid orangered;
    }
    .content{
        width: 100%;
        display: inline-block;
    }
    .info-content{
        width: 100%;
        display: inline-block;
    }
    .info-content div{
        height: 30px;
        padding: 30px 0;
        font-size: 17px;
    }
    .collection-content{
        width: 100%;
        display: inline-block;
    }
    .collection-content .dir{
        width: 100%;
        height: 90px;
        border-bottom: 1px solid #e1e1e1;
    }
    .collection-content .dir .my-dir{
        display: inline-block;
        height: 90px;
        line-height: 90px;
        font-size: 16px;
        color: #3d3d3d;
        font-weight: 700;
        border-bottom: 4px solid #ca0c16;
    }
    .collection-content .dir .new-dir{
        display: inline-block;
        height: 90px;
        line-height: 90px;
        float: right;
        font-size: 16px;
        color: #6b6b6b;
        cursor: pointer;
    }
    .collection-content .dir-list{
        width: 100%;
        display: inline-block;
    }
    .dir-list ul{
        width: 100%;
        height: 100%;
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .dir-list ul li{
        width: 100%;
        height: 90px;
        border-bottom: 1px solid #e1e1e1;
        position: relative;

    }
    .dir-name, .content-count{
        width: 100%;
        height: 50%;
    }
    .dir-name{
        font-size: 16px;
        color: #3d3d3d;
        font-weight: 700;
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .content-count{
        font-size: 14px;
        color: #999;
        display: flex;
        align-items: center;
    }
    .in-dir{
        position: absolute;
        height: 100%;
        right: 10px;
        display: flex;
        align-items: center;
        transform: translate(0, -100%);
    }
    .in-dir img{
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    .detail-dir{
        width: 100%;
        display: inline-block;
    }
    .back-to-dirlist{
        width: 100%;
        height: 84px;
        border-bottom: 1px solid #e1e1e1;
        display: flex;
        align-items: center;
    }
    .back-to-dirlist div{
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .back-to-dirlist img{
        height: 16px;
        width: 16px;
    }
    .back-to-dirlist span{
        font-size: 16px;
        color: 3d3d3d;
        font-weight: 700;
        margin-left: 10px;
    }
    .dir-info{
        width: 100%;
        height: 80px;
        border-bottom: 1px solid #e1e1e1;
    }
    .info-name{
        font-weight: 700;
        font-size: 16px;
        display: flex;
        align-items: center;
        width: 100%;
        height: 50%;
    }
    .info-name span{
        color: #4d4d4d;
    }
    .info-items{
        font-size: 14px;
        display: flex;
        align-items: center;
        width: 100%;
        height: 50%;
    }
    .info-items span{
        color: #999;
        padding: 0 8px;
    }
    .info-items .ed, .info-items .del, .info-items .manage{
        color: #6b6b6b;
        cursor: pointer;
    }
    .dir-items-list, .dir-items-list ul{
        width: 100%;
        display: inline-block;
    }
    .dir-items-list ul{
        padding: 20px 0 0 0;
        list-style: none;
        margin: 0;

    }
    .dir-items-list ul li{
        margin-bottom: 10px;
        background: #fafafa;
        width: 100%;
        min-height: 104px;
        padding: 15px;
    }
    .items-title-box, .topic-info{
        width: 100%;
        height: 20%;
    }
    .topic-intro{
        width: 100%;
        height: 60%;
        margin-bottom: 10px;
        min-height: 60px;
        max-height: 60px;
        overflow: hidden;

    }
    .items-title-box{
        margin-bottom: 10px;
    }
    .topic-type{
        font-size: 12px;
        color: #fff;
        font-weight: 600;
        background: #80bd01;
        border-radius: 3px;
        padding: 1px 2px;
    }
    .topic-title-name{
        font-size: 16px;
        color: #4d4d4d;
        font-weight: 700;
        margin-left: 5px;
        cursor: pointer;
    }
    .no-collect{
        font-size: 14px;
        color: #6b6b6b;
        float: right;
        cursor: pointer;
    }
    .topic-intro span{
        color: #999;
        font-size: 14px;
    }
    .topic-info span{
        font-size: 14px;
        margin-right: 10px;
    }
    .topic-info-author{
        color: #6b6b6b;
    }
    .topic-info-pubtime{
        color: #999;
    }
    .no-any-topic{
        width: 100%;
        font-size: 30px;
        color: #999;
        display: flex;
        justify-content: center;
        margin-top: 50px;
    }
</style>
{{ /block }}


{{ block 'content' }}
<div class="personal-box">

    <div class="box-l">
        <img src="{{ user.head }}" alt="" class="head">
        <div class="user-name"><span>{{ user.name }}</span></div>
        <div class="user-email">
            <img src="/public/img/email.png" alt="">
            <span>{{ user.email }}</span>
        </div>
        <a href="#" class="btn btn-info">编辑信息</a>
    </div>

    <div class="box-r">

        <div class="top-bar">
            <span class="info active">个人信息</span>
            <span class="topic">我的话题</span>
            <span class="start">我的关注</span>
            <span class="collection">我的收藏</span>
            <span class="msg">消息</span>
            {{ block 'privilege' }} {{ /block }}
        </div>

        <div class="content">
            <div class="info-content">
                <div><span>昵称：&nbsp;&nbsp;</span><span>{{ user.name }}</span></div>
                <div><span>i&nbsp;d：&nbsp;&nbsp;</span><span>{{ user._id }}</span></div>
                <div><span>邮箱：&nbsp;&nbsp;</span><span>{{ user.email }}</span></div>
                <div><span>性别：&nbsp;&nbsp;</span><span class="gender-span">{{ user.gender }}</span></div>
                <div><span>简介：&nbsp;&nbsp;</span><span class="intro-span">{{ user.introduce }}</span></div>
                <div><span>注册时间：&nbsp;&nbsp;</span><span>{{ user.register_time }}</span></div>
                <div><span>最后一次修改信息时间：&nbsp;&nbsp;</span><span>{{ user.last_modifyTime }}</span></div>
            </div>


            <div class="topic-content"></div>

            <div class="start-content"></div>

            <div class="collection-content">
                <div class="dir">
                    <span class="my-dir">我创建的收藏夹</span>
                    <span class="new-dir">+&nbsp;新建收藏夹</span>
                </div>
                <div class="dir-list">
                    <ul>
                        {{ each collections }}
                        <li>
                            <div class="dir-name"><span>{{ $value.dir_name }}</span></div>
                            <div class="content-count"><span>{{ $value.topics_list.length }}条内容</span></div>
                            <div class="in-dir"><img src="/public/img/rightJT.png" alt=""></div>
                        </li>
                        {{ /each }}
                    </ul>
                </div>

                <div class="detail-dir">
                    <div class="back-to-dirlist">
                        <div>
                            <img src="/public/img/leftJT.png" alt="">
                            <span>返回我的收藏夹列表</span>
                        </div>
                    </div>
                    <div class="dir-info">
                        <div class="info-name"><span></span></div>
                        <div class="info-items">
                            <span class="items-count"></span>
                            <span>|</span>
                            <span class="ed">编辑</span>
                            <span>|</span>
                            <span class="del">删除</span>
                            <span>|</span>
                            <span class="manage">内容管理</span>
                        </div>
                    </div>
                    <div class="dir-items-list">
                        <ul>
                            <li class="dir-items-each-li">
                                <div class="items-title-box">
                                    <span class="topic-type"></span>
                                    <span class="topic-title-name"></span>
                                    <span class="no-collect">取消收藏</span>
                                </div>

                                <div class="topic-intro">
                                    <span class="easy-intro">简介:</span>
                                    <span class="main-intro"></span>
                                </div>

                                <div class="topic-info">
                                    <span class="topic-info-author">Lpyexolore</span>
                                    <span>|</span>
                                    <span class="topic-info-pubtime">2020-11-03 21:21:36</span>
                                </div>
                                <input type="hidden" value="">

                            </li>

                            <div class="no-any-topic"><span>暂时没有收藏任何话题</span></div>
                        </ul>
                    </div>
                </div>

            </div>

            <div class="msg-content"></div>

            {{ block 'pri-content' }} {{ /block }}

        </div>

    </div>
</div>
{{ /block }}

{{ block 'script' }}

<script>
    $(function () {
        const $each_bar = $('.top-bar span')
        const $content = $('.content').children()
        $content.eq(0).show().siblings().hide()
        //监听个人中心导航栏的点击
        $each_bar.click(function () {
            $(this).addClass('active').siblings().removeClass('active')
            $content.eq($(this).index()).show().siblings().hide()
        })
        const $gender = $('.gender-span')
        const $intro = $('.intro-span')
        //判断性别
        switch (parseInt($gender.html())) {
            case -1:
                $gender.html('保密')
                break
            case 0:
                $gender.html('男')
                break
            case 1:
                $gender.html('女')
        }
        //判断简介内容是否为空
        if(!$intro.html()) {
            $intro.html('无')
        }

        const $dir_name = $('.dir-name')
        const $in_dir = $('.in-dir')
        const $dir_list =$('.dir-list')
        const $dir = $('.dir')
        const $detail_dir = $('.detail-dir')
        $detail_dir.hide()

        //监听收藏的文件夹的点击
        $dir_name.click(function () {
            $dir.hide()
            $dir_list.hide()
            const $formdata = 'dir_name=' + $(this).children().html()
            $.ajax({
                url: '/getThisDir',
                type: 'get',
                dataType: 'json',
                data: $formdata,
                success: function (data) {
                    if(data.status === 500) {
                        window.alert('服务器繁忙，请稍后重试')
                    }
                    else if(data.status === 1) {

                        $detail_dir.fadeIn(900, 'swing')
                        const $info_name = $('.info-name')
                        $info_name.children().html($(this).children().html())
                        const $items_count = $('.items-count')
                        let $items_count_num = data.TopicsInfo.length
                        $items_count.html( $items_count_num + '条内容')
                        let $li = $('.dir-items-each-li')
                        const $no_any_topic = $('.no-any-topic')
                        $no_any_topic.hide()
                        if(data.TopicsInfo.length === 0) {
                            $no_any_topic.show()
                            $li.hide()
                        }
                        else {
                            if($li.length > 1) {
                                for(let i=0; i<$li.length - 1; i++) {
                                    $li.eq(i).remove()
                                }
                            }
                            $li = $('.dir-items-each-li')
                            for(let i=1; i < data.TopicsInfo.length; i++) {
                                $li.after($li.clone())
                            }
                            $li = $('.dir-items-each-li')
                            $li.each(function (i) {
                                $(this).children().eq(3).prop({'value': data.TopicsInfo[i]._id})
                                $(this).children().eq(0).children().eq(0).html(data.TopicsInfo[i].type)
                                $(this).children().eq(2).children().eq(0).html(data.TopicsInfo[i].author_name).next().next().html(data.TopicsInfo[i].publish_time)
                                //对简介内容进行切割处理
                                const $topic_intro_width = $('.topic-intro').outerWidth()

                                let content_string = ''
                                for(let s of data.TopicsInfo[i].content) {
                                    if(14 * content_string.length <= 3 * $topic_intro_width - 200) {
                                        content_string += s
                                    }
                                    else {
                                        content_string += '...'

                                        return $(this).children().eq(1).children().eq(1).html(content_string)
                                    }
                                }
                                $(this).children().eq(1).children().eq(1).html(content_string)
                                //对标题进行切割
                                let title_string = ''
                                for(let t of data.TopicsInfo[i].title) {
                                    if(16 * title_string.length <=  $topic_intro_width - 180) {
                                        title_string += t
                                    }
                                    else {
                                        title_string += '...'

                                        return $(this).children().eq(0).children().eq(1).html(title_string)
                                    }
                                }
                                $(this).children().eq(0).children().eq(1).html(title_string)


                            })

                            //初始化一下一下每个文章的取消收藏按钮
                            let $remove_my_collect_topic = $('.no-collect')
                            //处理每一个文章的取消收藏点击按钮
                            $remove_my_collect_topic.each(function (i) {
                                $(this).click(function () {
                                    const $this_id = $(this).parent().next().next().next().prop('value')
                                    let $formdata = 'id=' + $this_id
                                    $.ajax({
                                        url: '/removeCollection',
                                        type: 'get',
                                        dataType: 'json',
                                        data: $formdata,
                                        success: function (data) {
                                            if(data.status === 500) {
                                                window.alert('服务器繁忙，请稍后重试')
                                            }
                                            else if(data.status === -1) {
                                                window.alert('请先登录账户')
                                            }
                                            else if(data.status === 0) {
                                                window.alert('取消收藏失败,未查询到相关文章信息')
                                            }
                                            else if(data.status === 1) {
                                                window.alert('取消收藏成功')
                                                //移除被取消收藏的话题
                                                $li = $('.dir-items-each-li')
                                                $li.each(function (i) {
                                                    if($(this).children().eq(3).prop('value') === $this_id) {
                                                        $(this).remove()
                                                    }
                                                })
                                                //更新文件夹中收藏的话题文章数量
                                                $items_count_num --
                                                $items_count.html( $items_count_num + '条内容')
                                                const $content_count = $('.content-count')
                                                $content_count.children().html($items_count_num + '条内容')
                                            }
                                        }
                                    })
                                })
                            })
                        }


                    }
                }
            })
        })


        //监听进入收藏文件夹中的右箭头点击
        $in_dir.click(function () {
            $dir.hide()
            $dir_list.hide()
            const $formdata = 'dir_name=' + $(this).prev().prev().children().html()
            $.ajax({
                url: '/getThisDir',
                type: 'get',
                dataType: 'json',
                data: $formdata,
                success: function (data) {
                    if(data.status === 500) {
                        window.alert('服务器繁忙，请稍后重试')
                    }
                    else if(data.status === 1) {

                        $detail_dir.fadeIn(900, 'swing')
                        const $info_name = $('.info-name')
                        $info_name.children().html($(this).prev().prev().children().html())
                        const $items_count = $('.items-count')
                        let $items_count_num = data.TopicsInfo.length
                        $items_count.html( $items_count_num + '条内容')
                        let $li = $('.dir-items-each-li')
                        const $no_any_topic = $('.no-any-topic')
                        $no_any_topic.hide()
                        if(data.TopicsInfo.length === 0) {
                            $no_any_topic.show()
                            $li.hide()
                        }
                        else {
                            if($li.length > 1) {
                                for(let i=0; i<$li.length - 1; i++) {
                                    $li.eq(i).remove()
                                }
                            }
                            $li = $('.dir-items-each-li')
                            for(let i=1; i < data.TopicsInfo.length; i++) {
                                $li.after($li.clone())
                            }
                            $li = $('.dir-items-each-li')
                            $li.each(function (i) {
                                $(this).children().eq(3).prop({'value': data.TopicsInfo[i]._id})
                                $(this).children().eq(0).children().eq(0).html(data.TopicsInfo[i].type)
                                $(this).children().eq(2).children().eq(0).html(data.TopicsInfo[i].author_name).next().next().html(data.TopicsInfo[i].publish_time)
                                //对简介内容进行切割处理
                                const $topic_intro_width = $('.topic-intro').outerWidth()

                                let content_string = ''
                                for(let s of data.TopicsInfo[i].content) {
                                    if(14 * content_string.length <= 3 * $topic_intro_width - 200) {
                                        content_string += s
                                    }
                                    else {
                                        content_string += '...'

                                        return $(this).children().eq(1).children().eq(1).html(content_string)
                                    }
                                }
                                $(this).children().eq(1).children().eq(1).html(content_string)
                                //对标题进行切割
                                let title_string = ''
                                for(let t of data.TopicsInfo[i].title) {
                                    if(16 * title_string.length <=  $topic_intro_width - 180) {
                                        title_string += t
                                    }
                                    else {
                                        title_string += '...'

                                        return $(this).children().eq(0).children().eq(1).html(title_string)
                                    }
                                }
                                $(this).children().eq(0).children().eq(1).html(title_string)


                            })

                            //初始化一下一下每个文章的取消收藏按钮
                            let $remove_my_collect_topic = $('.no-collect')
                            //处理每一个文章的取消收藏点击按钮
                            $remove_my_collect_topic.each(function (i) {
                                $(this).click(function () {
                                    const $this_id = $(this).parent().next().next().next().prop('value')
                                    let $formdata = 'id=' + $this_id
                                    $.ajax({
                                        url: '/removeCollection',
                                        type: 'get',
                                        dataType: 'json',
                                        data: $formdata,
                                        success: function (data) {
                                            if(data.status === 500) {
                                                window.alert('服务器繁忙，请稍后重试')
                                            }
                                            else if(data.status === -1) {
                                                window.alert('请先登录账户')
                                            }
                                            else if(data.status === 0) {
                                                window.alert('取消收藏失败,未查询到相关文章信息')
                                            }
                                            else if(data.status === 1) {
                                                window.alert('取消收藏成功')
                                                //移除被取消收藏的话题
                                                $li = $('.dir-items-each-li')
                                                $li.each(function (i) {
                                                    if($(this).children().eq(3).prop('value') === $this_id) {
                                                        $(this).remove()
                                                    }
                                                })
                                                //更新文件夹中收藏的话题文章数量
                                                $items_count_num --
                                                $items_count.html( $items_count_num + '条内容')
                                                const $content_count = $('.content-count')
                                                $content_count.children().html($items_count_num + '条内容')
                                            }
                                        }
                                    })
                                })
                            })
                        }


                    }
                }
            })
        })


        //监听返回收藏话题文件夹目录按钮的点击
        const $back_to_dir_list = $('.back-to-dirlist div')
        $back_to_dir_list.click(function () {
            $detail_dir.hide()
            $dir.fadeIn(900, 'swing')
            $dir_list.fadeIn(900, 'swing')
        })

        //监听收藏夹列表中的取消收藏按钮






    })
</script>

{{ block 'pri-script' }}

{{ /block }}

{{ /block }}


